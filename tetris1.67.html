<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<title> Paca MAn</title>
	<style>
		* {
			padding: 0;
			margin: 0;
		}

		canvas {
			background: #eee;
			display: block;
			margin: 0 auto;
		}
	</style>
</head>
<body>

	<canvas id="myCanvas" width="800" height="1000"></canvas>

	<script>


		var canvas = document.getElementById("myCanvas");
		var context = canvas.getContext("2d");

		var level = [
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
			[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
		];


		var levVerLen = level.length;
		var levHorzLen = level[0].length;

		var pieces = [
			[
				[
					[1, 1, 1, 1],
					[0, 0, 0, 0],
					[0, 0, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 0, 1, 0],
					[0, 0, 1, 0],
					[0, 0, 1, 0],
					[0, 0, 1, 0]
				],
				[
					[1, 1, 1, 1],
					[0, 0, 0, 0],
					[0, 0, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 0, 1, 0],
					[0, 0, 1, 0],
					[0, 0, 1, 0],
					[0, 0, 1, 0]
				]
			],
			[
				[
					[0, 0, 0, 0],
					[1, 1, 0, 0],
					[0, 1, 1, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 1, 0, 0],
					[1, 1, 0, 0],
					[1, 0, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 0, 0, 0],
					[1, 1, 0, 0],
					[0, 1, 1, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 1, 0, 0],
					[1, 1, 0, 0],
					[1, 0, 0, 0],
					[0, 0, 0, 0]
				]
			],
			[
				[
					[0, 0, 0, 0],
					[0, 0, 1, 1],
					[0, 1, 1, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 0, 1, 0],
					[0, 0, 1, 1],
					[0, 0, 0, 1],
					[0, 0, 0, 0]
				],
				[
					[0, 0, 0, 0],
					[0, 0, 1, 1],
					[0, 1, 1, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 0, 1, 0],
					[0, 0, 1, 1],
					[0, 0, 0, 1],
					[0, 0, 0, 0]
				]
			],
			[
				[
					[0, 1, 1, 0],
					[0, 1, 1, 0],
					[0, 0, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 1, 1, 0],
					[0, 1, 1, 0],
					[0, 0, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 1, 1, 0],
					[0, 1, 1, 0],
					[0, 0, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 1, 1, 0],
					[0, 1, 1, 0],
					[0, 0, 0, 0],
					[0, 0, 0, 0]
				]
			],
			[
				[
					[0, 0, 0, 1],
					[0, 1, 1, 1],
					[0, 0, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 0, 0, 0],
					[0, 0, 1, 0],
					[0, 0, 1, 0],
					[0, 0, 1, 1]
				],
				[
					[0, 0, 0, 0],
					[1, 1, 1, 0],
					[1, 0, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 0, 0, 0],
					[0, 1, 1, 0],
					[0, 0, 1, 0],
					[0, 0, 1, 0]
				]
			],
			[
				[
					[1, 0, 0, 0],
					[1, 1, 1, 0],
					[0, 0, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 1, 1, 0],
					[0, 1, 0, 0],
					[0, 1, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 0, 0, 0],
					[1, 1, 1, 0],
					[0, 0, 1, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 1, 0, 0],
					[0, 1, 0, 0],
					[1, 1, 0, 0],
					[0, 0, 0, 0]
				]
			],
			[
				[
					[0, 1, 0, 0],
					[1, 1, 1, 0],
					[0, 0, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 1, 0, 0],
					[0, 1, 1, 0],
					[0, 1, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 0, 0, 0],
					[1, 1, 1, 0],
					[0, 1, 0, 0],
					[0, 0, 0, 0]
				],
				[
					[0, 1, 0, 0],
					[1, 1, 0, 0],
					[0, 1, 0, 0],
					[0, 0, 0, 0]
				],
			]
		];



		var brick = new Array();
		var background = new Image();
		var grid = new Array();
		var backgrid = new Array();

		grid[0] = new Image();
		grid[1] = new Image();
		backgrid[0] = new Image();
		backgrid[1] = new Image();
		brick[0] = new Image();
		brick[0].src = "brick1.png";
		background.src = "background1.png";
		grid[0].src = "grid.png";
		grid[1].src = "grid2.png";
		backgrid[0].src = "backgrid.png";
		backgrid[1].src = "backgrid2.png";

		var backgridnum = 0;


		var currentpiece;
		var nextpiece;
		var holdpiece = 0;
		var gamespeed;

		var keypress = 0;

		var scalex;
		var scaley;

		var speed;

		var movepiecetimer = 0;

		var buttonpress = 0;

		var piecehit = 0;
		var drop = 0;

		scalex = 1;
		speed = 5;

		var droptimer = 0;

		var buttonpresstimer = 0;

		var frame = 0;
		var snd = new Audio("data:audio/wav;base64,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");

		document.addEventListener("keydown", keyDown, false);
		document.addEventListener("keyup", keyUp, false);


		picknextpiece();
		addpiecetop();

		var placepiecetimerdefault = 200;



		function drawLevel() {


			context.drawImage(background, 0, 0);


			for (var v = 0; v < level.length; v++) {
				for (var h = 0; h < level[0].length; h++) {
					var xpos = h * 36;
					var ypos = v * 36;
					if (level[v][h] == 1) {
						context.drawImage(brick[0], xpos * scalex + 220, ypos * scalex + 36, brick[0].width * scalex, brick[0].height * scalex);
					}
					else {
						context.drawImage(backgrid[backgridnum], xpos * scalex + 220, ypos * scalex + 36, brick[0].width * scalex, brick[0].height * scalex);
					}
				}
			}


			if (buttonpress == 1) {
				moverightleft(1);
				if (piecehit == 1) {
					placepiecetimer = placepiecetimerdefault;
					piecehit = 0;
				}
			}
			else if (buttonpress == 2) {
				moverightleft(-1);
				if (piecehit == 1) {
					placepiecetimer = placepiecetimerdefault;
					piecehit = 0;
				}
			}

			if (drop == 1 && piecehit == 0) {

				while (piecehit == 0) {
					movepiecedown();
				}
				drop = 0;
			}

			if (drop == 1 && piecehit == 1) {
				drop = 0;
				placepiecetimer = -1;
				movepiecetimer = 3 * (21 - (speed * 2));
			}

			if (movepiecetimer == 3 * (21 - (speed * 2))) {

				if (drop == 0) {
					movepiecedown();
					movepiecetimer = 0;
				}
			}



			movepiecetimer++;

			for (i = 0; i < 60 / speed; i++) {

				buttonpresstimer--;
				if (buttonpresstimer = 0) {
					buttonpress = 0
				}

			}


			drawgrid();
			drawcurrentpiece();
			drawnextpiece();
			drawholdpiece();

			frame++;

			for (i = 0; i < 30 / speed; i++) { droptimer--; }
			for (i = 0; i < speed; i++) { placepiecetimer--; }


			context.fillStyle = "white";
			context.font = (40 * scalex) + "px Arial";
			context.fillText(Math.trunc(frame / 60), 40 * scalex, 780 * scalex);


		}

		function drawcurrentpiece() {

			for (var v = 0; v < currentpiece[0].length; v++) {
				for (var h = 0; h < currentpiece[0][v].length; h++) {
					if (currentpiece[0][v][h] == 1) {
						context.drawImage(brick[0], currentpiece[1] * 36 + (36 * h) + 220, currentpiece[2] * 36 + (36 * v) + 36);
					}
				}
			}
		}

		function drawnextpiece() {

			for (var v = 0; v < nextpiece[0].length; v++) {
				for (var h = 0; h < nextpiece[0][v].length; h++) {
					if (nextpiece[0][v][h] == 1) {
						context.drawImage(brick[0], nextpiece[1] * 36 + (36 * h) + 500, nextpiece[2] * 36 + (36 * v) + 72);
					}
				}
			}
		}

		function drawholdpiece() {

			if (holdpiece !== 0) {
				for (var v = 0; v < heldpiece[0].length; v++) {
					for (var h = 0; h < heldpiece[0][v].length; h++) {
						if (heldpiece[0][v][h] == 1) {
							context.drawImage(brick[0], heldpiece[1] * 36 + (36 * h) - 72, heldpiece[2] * 36 + (36 * v) + 72);
						}
					}
				}
			}
		}

		var gridfinder = 0;
		var oggridfinder = [0, 0, 0];


		function drawgrid() {




			gridfinder = 0;
			oggridfinder[0] = currentpiece[0];
			oggridfinder[1] = currentpiece[1];
			oggridfinder[2] = currentpiece[2];

			while (gridfinder == 0) {
				allocategrid();
			}


			for (var v = 0; v < oggridfinder[0].length; v++) {
				for (var h = 0; h < oggridfinder[0][v].length; h++) {
					if (oggridfinder[0][v][h] == 1) {
						context.drawImage(grid[backgridnum], oggridfinder[1] * 36 + (36 * h) + 220, oggridfinder[2] * 36 + (36 * v) + 36);
					}
				}
			}

		}

		function allocategrid() {

			var t = false;

			t = true;

			oggridfinder[2]++

			for (var v = 0; v < oggridfinder[0].length; v++) {
				for (var h = 0; h < oggridfinder[0][v].length; h++) {

					if (oggridfinder[0][v][h] == 1) {
						if (level[oggridfinder[2] + v] !== undefined && level[oggridfinder[2] + v][oggridfinder[1] + h] == 0) {

						} else {
							t = false;
							gridfinder = 1;
							oggridfinder[2]--;
							break;
						}
					}

				}
				if (t == false) {
					break;
				}
			}


			//if (t == true) { oggridfinder[2]++ };


		}

		function movepiecedown() {

			var t = false;
			t = false;

			currentpiece[2]++;

			for (var v = 0; v < currentpiece[0].length; v++) {
				for (var h = 0; h < currentpiece[0][v].length; h++) {

					if (currentpiece[0][v][h] == 1) {
						if (level[currentpiece[2] + v] !== undefined && level[currentpiece[2] + v][currentpiece[1] + h] == 0 && piecehit == 0) {

						}
						else {

							currentpiece[2]--;
							t = true;
							placepiece();
							piecehit = 1;
							if (placed == 1) { placed = 0; piecehit = 0; }
							break;
						}
					}
				}
				if (t == true) {
					break;
				}
			}



		}

		var placepiecetimer = -1;

		var placed = 0;

		function placepiece() {

			console.log(placepiecetimer)



			if (placepiecetimer < 0 && piecehit == 0) {
				placepiecetimer = placepiecetimerdefault;
			}

			if (placepiecetimer < 0 && piecehit == 1) {


				for (var v = 0; v < currentpiece[0].length; v++) {
					for (var h = 0; h < currentpiece[0][v].length; h++) {
						if (currentpiece[0][v][h] == 1 && level[currentpiece[2] + v] !== undefined) {
							level[currentpiece[2] + v][currentpiece[1] + h] = 1;
						}
					}
				}

				piecehit = 0;
				placed = 1;
				snd.play();
				checklineclear();
				addpiecetop();
				placepiecetimer = -1;
			}

		}

		var linesremoved = [];

		function checklineclear() {

			var t;
			linesremoved = [];

			for (var v = level.length - 1; v > 0; v--) {
				t = 0;
				for (var h = 0; h < level[0].length; h++) {
					if (level[v][h] == 0) {
						break
					}
					else {
						t++;
					}
				}
				if (t == 10) {
					linesremoved.push(v);
				}
			}
			

			removelines();

		}


		function removelines() {
			

			for (var v = 0; v < linesremoved.length; v++) {
				for (var x = linesremoved[v]; x > 0; x--) {
					for (var y = 0; y < level[0].length; y++) {
						if (level[x][y] == 1 && linesremoved[v] == x) {
							level[x][y] = 0;
						}
						else if (level[x][y] == 1 && linesremoved[v] >= x) {
							level[x][y] = 0;
							level[x + 1][y] = 1;
						}
					}
				}
				linesremoved.shift();
				if (linesremoved.length >= 1) {
					for (var q = 0; q < linesremoved.length; q++) {
						linesremoved[q]++;
					}
				}
				v--;
			}

		}

		function moverightleft(m) {

			var t;
			var x;
			t = 3;
			x = 0;

			currentpiece[1] += m;

			for (var v = 0; v < currentpiece[0].length; v++) {
				for (var h = 0; h < currentpiece[0][v].length; h++) {
					if (currentpiece[0][v][h] == 1) {
						if (level[currentpiece[2] + v][currentpiece[1] + h] !== undefined && level[currentpiece[2] + v][currentpiece[1] + h] == 0) {
							x = 1;
						}
						else {
							t = 0;
							x = 0;
							currentpiece[1] -= m;
							break;
						}
					}
				}
				if (t == 0) { break; }
			}


			if (x == 1) {
				if (buttonpresstimer > 0) {
					buttonpresstimer = 0;
					buttonpress = 0;
				}
			}

		}

		var rotationcurrent = 0;


		function checkrotation(m, w) {

			var t;
			var outbounds;



			outbounds = 0;
			t = 0;


			if (placepiecetimer > 0 && piecehit == 1) {
				placepiecetimer = placepiecetimerdefault;
				piecehit = 0;
			}

			for (var v = 0; v < currentpiece[0].length; v++) {
				for (var h = 0; h < currentpiece[0][v].length; h++) {
					if (currentpiece[0][v][h] == 1) {
						if (level[currentpiece[2] + v] !== undefined && level[currentpiece[2] + v][currentpiece[1] + h] == 0 && level[currentpiece[2] + v][currentpiece[1] + h] !== undefined) {
							t = 1;
						}
						else {
							if (level[currentpiece[2] + v] !== undefined) {
								if (level[currentpiece[2] + v][currentpiece[1] + h] == 1) {
									t = 2;
									break;
								}
							}
							outbounds++;
							if (level[currentpiece[2] + v] == undefined) {
								outbounds = 3;
							}

						}
					}
				}
				if (t == 2) {
					break;
				}


			}


			console.log("outbounds:", outbounds)
			console.log("currentpiece:", currentpiece)

			if (outbounds == 1 && currentpiece[1] < 4) {
				currentpiece[1] += 1;
			}
			else if (outbounds == 1 && currentpiece[1] > 4) {
				currentpiece[1] -= 1;
			}
			else if (outbounds == 2 && currentpiece[1] < 4) {
				currentpiece[1] += 2;
			}
			else if (outbounds == 2 && currentpiece[1] > 4) {
				currentpiece[1] -= 2;
			}
			else if (outbounds == 1 && currentpiece[2] < 1) {
				currentpiece[2] += 1;
			}
			else if (outbounds == 3 && currentpiece[2] < 1) {
				currentpiece[2] += 1;
			}
			else if (outbounds > 1) {
				currentpiece[0] = w[0]
				currentpiece[1] = w[1];
				currentpiece[2] = w[2];
				currentpiece[4] = w[3];
			}
			else if (t==2) {
				currentpiece[0] = w[0]
				currentpiece[1] = w[1];
				currentpiece[2] = w[2];
				currentpiece[4] = w[3];
			}
		}


		function rotatepiece(m) {

			var w
			var og = [0, 0, 0, 0];

			w = currentpiece[3];

			og[0] = currentpiece[0];
			og[1] = currentpiece[1];
			og[2] = currentpiece[2];
			og[3] = currentpiece[4];


			if (m == 1) {

				if (currentpiece[4] == 1) {
					currentpiece[4] = 2;
					currentpiece[0] = pieces[w][1];
					checkrotation(w, og);
				}
				else if (currentpiece[4] == 2) {
					currentpiece[4] = 3;
					currentpiece[0] = pieces[w][2];
					checkrotation(w, og);
				}
				else if (currentpiece[4] == 3) {
					currentpiece[4] = 4;
					currentpiece[0] = pieces[w][3];
					checkrotation(w, og);
				}
				else if (currentpiece[4] == 4) {
					currentpiece[4] = 1;
					currentpiece[0] = pieces[w][0];
					checkrotation(w, og);
				}

			}
			else if (m == -1) {

				if (currentpiece[4] == 1) {
					currentpiece[4] = 4;
					currentpiece[0] = pieces[w][3];
					checkrotation(w, og);
				}
				else if (currentpiece[4] == 4) {
					currentpiece[4] = 3;
					currentpiece[0] = pieces[w][2];
					checkrotation(w, og);
				}
				else if (currentpiece[4] == 3) {
					currentpiece[4] = 2;
					currentpiece[0] = pieces[w][1];
					checkrotation(w, og);
				}
				else if (currentpiece[4] == 2) {
					currentpiece[4] = 1;
					currentpiece[0] = pieces[w][0];
					checkrotation(w, og);
				}


			}


		}

		var heldpiece = new Array();
		var temppiece = new Array();

		function holdingpiece() {

			if (holdpiece == 0) {
				heldpiece[0] = pieces[currentpiece[3]][0];
				heldpiece[1] = 3;
				heldpiece[2] = 0;
				if (currentpiece[3] == 1 || currentpiece[3]==2) {
					heldpiece[2] = -1;
				}
				heldpiece[3] = currentpiece[3];
				heldpiece[4] = 1;
				holdpiece = 1;
				addpiecetop();
				picknextpiece();

				piecehit = 0;
				placed = 1;
				placepiecetimer = -1;
			}
			else if (holdpiece==1){
				for (var x = 0; x < heldpiece.length; x++) {
					temppiece[x] = heldpiece[x];
				}

				heldpiece[2] = 0;
				if (currentpiece[3] == 1 || currentpiece[3] == 2) {
					heldpiece[2] = -1;
				}
				heldpiece[0] = pieces[currentpiece[3]][0];
				heldpiece[3] = currentpiece[3];
				currentpiece[0] = temppiece[0];
				currentpiece[1] = 3;
				currentpiece[3] = temppiece[3];
				currentpiece[2] = 0;
				if (currentpiece[3] == 1 || currentpiece[3] == 2) {
					currentpiece[2] = -1;
				}
				currentpiece[4] = 1;
				holdpiece = 2;

				piecehit = 0;
				placed = 1;
				placepiecetimer = -1;
				
			}

		}

		function picknextpiece() {

			var x = randompiece();
			piecehit = 0;

			if (holdpiece == 2) {
				holdpiece = 1;
			}

			nextpiece = [pieces[x][0], 3, 0, x, 1];


			if (nextpiece[3] == 2 || nextpiece[3] == 1) {
				nextpiece[2] = -1;
			}


		}

		function addpiecetop() {

			currentpiece = nextpiece;// piece, xpos, ypos, piece, rotation

			picknextpiece();

			movepiecetimer = 0;
			placepiecetimer = -1;


		}


		function randompiece() {


			//return([[0,1,1], [1,1,0]]);
			var x;
			x = Math.floor(Math.random() * pieces.length);
			return (x);
			return ([[1, 1, 0], [0, 1, 1]]);

			return ([[1], [1], [1], [1]]);


			return ([[1, 0, 0], [1, 1, 1]]);

		}

		function restartlev() {

			level = [
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
			];

			drop = 0;
			droptimer = 0;
			buttonpress = 0;
			buttonpresstimer = 0;
			movepiecetimer = 0
			piecehit = 0;
			addpiecetop();

		}

		function keyDown(e) {


			if (e.keyCode == 68) {
				buttonpress = 1;
				buttonpresstimer = 60;
			}
			else if (e.keyCode == 65) {
				buttonpress = 2;
				buttonpresstimer = 60;
			}
			else if (e.keyCode == 37) {
				rotatepiece(1);
			}
			else if (e.keyCode == 39) {
				rotatepiece(-1);
			}
			else if (e.keyCode == 38) {
				holdingpiece();
			}
			else if (e.keyCode == 40 || e.keyCode == 83) {
				if (droptimer < 0) {
					drop = 1;
					droptimer = 30;
				}
			}
			else if (e.keyCode == 82) {
				restartlev(1);
			}
			else if (e.keyCode == 50) {
				backgridnum = 1;
			}
			else if (e.keyCode == 49) {
				backgridnum = 0;
			}
		}

		function keyUp(e) {

			if (e.keyCode == 39 || e.keyCode == 68) {
				buttonpress = 0;
			}
			else if (e.keyCode == 37 || e.keyCode == 65) {
				buttonpress = 0;
			}
			else if (e.keyCode == 40 || e.keyCode == 83) {
				buttonpress = 3;
			}
		}

		setInterval(drawLevel, 16);

		debugger;


	</script>

</body>
</html>